function log(e){console.log(e)}function rads(e){return e*Math.PI/180}function numst(e){return String(e.toFixed(2))}function setMatUniform(e,t){for(mat in mats)mats[mat].uniforms[e].value=t}function init(){container=document.getElementById("globecontainer");try{renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!1}),renderer.setSize(container.offsetWidth,container.offsetWidth),renderer.setClearColor(16382457),renderer.autoClear=!1,container.appendChild(renderer.domElement)}catch(e){log("Couldn't make THREE.js renderer:",e)}scene=new THREE.Scene;var t=15,a=renderer.domElement.width,o=renderer.domElement.height,i=a/o;camera=new THREE.PerspectiveCamera(t,i,.1,1e4),scene.add(camera),camera.position.z=-1200,camera.position.y=0,camera.lookAt(scene.position),camera.updateMatrix(),ambientLight=new THREE.AmbientLight(0),scene.add(ambientLight),pointLight=new THREE.PointLight(16777215,0),camera.add(pointLight),pointLight.position.set(0,200,300);var r=new THREE.SphereGeometry(100,8,8);light=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:16777215})),light.position=pointLight.position,light.scale.x=light.scale.y=light.scale.z=.05,scene.add(light);var n=16777215,s=16777215,u=10066329,l=100,m=THREE.ShaderLib.normalmap;uniforms=THREE.UniformsUtils.clone(m.uniforms),flatNormalTex=THREE.ImageUtils.loadTexture("../img/flat.png"),uniforms.tNormal={type:"t",value:flatNormalTex},uniforms.diffuse.value.setHex(s),uniforms.specular.value.setHex(u),uniforms.ambient.value.setHex(n),uniforms.shininess.value=l,uniforms.enableDiffuse={type:"i",value:1},uniforms.tDiffuseOpacity={type:"f",value:0},uniforms.tDiffuse2Opacity={type:"f",value:0},uniforms.uPointLightPos={type:"v3",value:pointLight.position},uniforms.uPointLightColor={type:"c",value:new THREE.Color(pointLight.color)},uniforms.uAmbientLightColor={type:"c",value:new THREE.Color(ambientLight.color)},uniforms.matrightBottom={type:"v2",value:new THREE.Vector2(180,-90)},uniforms.matleftTop={type:"v2",value:new THREE.Vector2(-180,90)},uniforms.sphereRadius={type:"f",value:100},uniforms.mixAmount={type:"f",value:1},uniforms.diffuse.value.convertGammaToLinear(),uniforms.specular.value.convertGammaToLinear(),uniforms.ambient.value.convertGammaToLinear(),uniforms.enableDisplacement={type:"i",value:1},uniforms.uDisplacementScale={type:"f",value:100},uniforms.uDisplacementPostScale={type:"f",value:50},uniforms.bumpScale={type:"f",value:1},uniforms.opacity={type:"f",value:0},uniforms.uNormalOffset={type:"v2",value:new THREE.Vector2(1,1)},material=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:vs_main,fragmentShader:fs_main,transparent:!0,depthTest:!1}),globeMat=material.clone(),globeMat.uniforms.tNormal={type:"t",value:flatNormalTex},globeMat.uniforms.tDiffuse={type:"t",value:new THREE.ImageUtils.loadTexture("../img/world.topo.4096_b.jpg")},globeMat.uniforms.tDisplacement={type:"t",value:globeTexture.texture2},globeMat.uniforms.uDisplacementPostScale={type:"f",value:4},globeMat.uniforms.bumpScale.value=10,globeMat.uniforms.opacity.value=1,globeMat.uniforms.mixAmount={type:"f",value:1},globeMat.depthTest=!0,globeMat.side=THREE.DoubleSide,globeTexture.textureMat2.uniforms.u_erode.value=.1,globeTexture.textureMat2.uniforms.u_dilate.value=.1,globeTexture.textureMat.uniforms.u_erode.value=.1,globeTexture.textureMat.uniforms.u_dilate.value=.1,alpsMat=material.clone(),alpsMat.uniforms.tNormal={type:"t",value:flatNormalTex},alpsMat.uniforms.tDiffuse.value=new THREE.ImageUtils.loadTexture("../img/alps_sm.jpg"),alpsMat.uniforms.tDisplacement={type:"t",value:alpsTexture.texture2},alpsMat.uniforms.matleftTop.value=new THREE.Vector2(-18,63),alpsMat.uniforms.matrightBottom.value=new THREE.Vector2(36,27),alpsMat.uniforms.bumpScale.value=10,alpsMat.uniforms.uDisplacementPostScale={type:"f",value:4},alpsMat.uniforms.tDiffuseOpacity={type:"f",value:1},alpsMat.uniforms.tDiffuse2Opacity={type:"f",value:0},alpsMat.uniforms.uPointLightColor={type:"c",value:(new THREE.Color).setRGB(.8,.8,.8)},alpsMat.depthTest=!0,alpsTexture.textureMat2.uniforms.u_erode.value=.1,alpsTexture.textureMat2.uniforms.u_dilate.value=.1,alpsTexture.textureMat.uniforms.u_erode.value=.1,alpsTexture.textureMat.uniforms.u_dilate.value=.1,regionMat=material.clone(),regionMat.uniforms.tNormal={type:"t",value:flatNormalTex},regionMat.uniforms.tDiffuse.value=new THREE.ImageUtils.loadTexture("../img/region2_color.jpg"),regionMat.uniforms.tDisplacement={type:"t",value:regionTexture.texture2},regionMat.uniforms.matleftTop.value=new THREE.Vector2(5.651247806,48.043751116),regionMat.uniforms.matrightBottom.value=new THREE.Vector2(9.25791303,44.437085892),regionMat.uniforms.uDisplacementPostScale={type:"f",value:1},regionMat.depthTest=!1,regionMat.side=THREE.DoubleSide,mountainMat=material.clone(),mountainMat.uniforms.tNormal={type:"t",value:flatNormalTex},mountainMat.uniforms.tDiffuse.value=new THREE.ImageUtils.loadTexture("../img/matterhorn_image_crop.jpg"),mountainMat.uniforms.tDisplacement={type:"t",value:new THREE.ImageUtils.loadTexture("../img/MH_DEM_02.jpg")},mountainMat.uniforms.matleftTop.value=new THREE.Vector2(7.625885,46.008221),mountainMat.uniforms.matrightBottom.value=new THREE.Vector2(7.700386,45.9566),mountainMat.uniforms.uDisplacementPostScale={type:"f",value:.04},mountainMat.depthTest=!0,mountainMat.uniforms.sphereRadius={type:"f",value:100.35},mats=[globeMat,globeMat,globeMat,globeMat,alpsMat,alpsMat,regionMat,mountainMat,globeMat],textureMats=[globeTexture.textureMat,globeTexture.textureMat2,alpsTexture.textureMat,alpsTexture.textureMat2,regionTexture.textureMat,regionTexture.textureMat2],globeGeo=new THREE.PlaneGeometry(10,10,257,129),globeGeo.computeTangents(),globeMesh=new THREE.Mesh(globeGeo,globeMat),globeMesh.frustumCulled=!1,alpsGeo=new THREE.PlaneGeometry(28,28,100,150),alpsGeo.computeTangents(),alpsMesh=new THREE.Mesh(alpsGeo,alpsMat),alpsMesh.frustumCulled=!1,regionGeo=new THREE.PlaneGeometry(28,28,102,102),regionGeo.computeTangents(),regionMesh=new THREE.Mesh(regionGeo,regionMat),regionMesh.frustumCulled=!1,mountainGeo=new THREE.PlaneGeometry(28,28,50,50),mountainGeo.computeTangents(),mountainMesh=new THREE.Mesh(mountainGeo,mountainMat),mountainMesh.frustumCulled=!1,rotator=new THREE.Object3D,rotator.add(globeMesh),rotator.add(alpsMesh),rotator.add(regionMesh),rotator.add(mountainMesh),globe.add(rotator),scene.add(globe),easeType=TWEEN.Easing.Quartic.InOut,easeSpeed=2e3,controls=new THREE.TrackballControls(camera,container),controls.addEventListener("change",render),controls.enabled=!1,addMouseHandler(renderer.domElement);for(x in RTTs)prepTextures(RTTs[x]);startLoop(),doDiv1(),startDivCheck(),endTime=new Date}function prepTextures(e){for(firstShader=fs_erode,secondShader=fs_dilate,e.textureMat.fragmentShader=firstShader,e.textureMat.needsUpdate=!0,e.textureMat2.fragmentShader=firstShader,e.textureMat2.needsUpdate=!0,e.textureMat.uniforms.colorMap.value=e.image,renderer.render(e.scene,e.camera,e.texture,!1),e.textureMat.uniforms.colorMap.value=e.texture2,x=0;x<loopSteps;x++)calculate(e);for(e.textureMat.fragmentShader=secondShader,e.textureMat.needsUpdate=!0,e.textureMat2.fragmentShader=secondShader,e.textureMat2.needsUpdate=!0,x=0;x<loopSteps;x++)calculate(e)}function calculate(e){renderer.render(e.scene2,e.camera2,e.texture2,!1),renderer.render(e.scene,e.camera,e.texture,!1)}function loop(){(mouseDown||TWEEN.update())&&(render(),controls.update()),requestId=requestAnimationFrame(loop)}function startLoop(){requestId||loop()}function stopLoop(){requestId&&(cancelAnimationFrame(requestId),requestId=void 0)}function render(){renderer.clear(),renderer.render(scene,camera)}function setView(e){for(x in viewsList)window[viewsList[x]]=viewsList[x]==e?!0:!1}function doDiv1(){(0!=currentView||-1==lastView)&&(lastView=currentView,currentView=0,getCameraState(),camPosTarget.y=400,camPosTarget.z=-800,camTargetTarget.y=0,globeTarget.y=globeRotation,lightTarget.x=0,lightTarget.y=200,lightTarget.z=0,rotatorTarget.x=0,rotatorTarget.z=0,doSceneTweens(),doMaterialTweens())}function doDiv2(){1!=currentView&&(lastView=currentView,currentView=1,getCameraState(),camPosTarget.y=400,camPosTarget.z=-800,camTargetTarget.y=0,globeTarget.y=globeRotation,lightTarget.x=0,lightTarget.y=200,lightTarget.z=0,rotatorTarget.x=0,rotatorTarget.z=0,doSceneTweens(),doMaterialTweens())}function doDiv3(){2!=currentView&&(lastView=currentView,currentView=2,getCameraState(),camPosTarget.y=300,camPosTarget.z=-150,camTargetTarget.y=100,globeTarget.y=globeRotation,lightTarget.x=0,lightTarget.y=200,lightTarget.z=300,rotatorTarget.x=.106,rotatorTarget.z=.756,doSceneTweens(),doMaterialTweens())}function doDiv4(){3!=currentView&&(currentView>3&&(globeSettings.uDisplacementPostScale=0),lastView=currentView,currentView=3,getCameraState(),camPosTarget.y=300,camPosTarget.z=-150,camTargetTarget.y=100,globeTarget.y=1,lightTarget.x=0,lightTarget.y=200,lightTarget.z=300,rotatorTarget.x=.45,rotatorTarget.z=.4,doSceneTweens(),lastView>3&&(globeSettings.opacity=0),doMaterialTweens())}function doDiv5(){4!=currentView&&(alpsSettings.opacity=0,lastView=currentView,currentView=4,getCameraState(),camPosTarget.y=150,camPosTarget.z=-50,camTargetTarget.y=100,globeTarget.y=globeRotation,lightTarget.x=0,lightTarget.y=200,lightTarget.z=150,rotatorTarget.x=.106,rotatorTarget.z=.756,doSceneTweens(),doMaterialTweens())}function doDiv6(){5!=currentView&&(6==currentView&&(alpsSettings.uDisplacementPostScale=2,alpsSettings.opacity2=0),lastView=currentView,currentView=5,getCameraState(),camPosTarget.y=120,camPosTarget.z=-20,camTargetTarget.y=100,globeTarget.y=globeRotation,lightTarget.x=0,lightTarget.y=200,lightTarget.z=150,rotatorTarget.x=.09,rotatorTarget.z=.775,doSceneTweens(),doMaterialTweens())}function doDiv7(){6!=currentView&&(regionSettings.opacity=0,regionMain.opacity=1,5==currentView&&(alpsSettings.uDisplacementPostScale=alpsMat.uniforms.uDisplacementPostScale.value,alpsSettings.opacity2=0),lastView=currentView,currentView=6,getCameraState(),camPosTarget.y=105,camPosTarget.z=-5,camTargetTarget.y=99.98,globeTarget.y=globeRotation,lightTarget.x=0,lightTarget.y=200,lightTarget.z=300,rotatorTarget.x=.09,rotatorTarget.z=.759,doSceneTweens(),doMaterialTweens())}function doDiv8(){7!=currentView&&(mountainSettings.opacity=0,mountainMain.opacity=1,6==currentView&&(regionSettings.opacity=0,regionMain.opacity=1),mtHeight=mountainMat.uniforms.sphereRadius.value,lastView=currentView,currentView=7,getCameraState(),camPosTarget.y=mtHeight+.09,camPosTarget.z=-.3,camTargetTarget.y=mtHeight+.02,globeTarget.y=-.5,lightTarget.x=0,lightTarget.y=200,lightTarget.z=300,rotatorTarget.x=.09277586790855208,rotatorTarget.z=.763802032176122,doSceneTweens(),doMaterialTweens())}function doDiv9(){8!=currentView&&(lastView=currentView,currentView=8,getCameraState(),camPosTarget.y=400,camPosTarget.z=-800,camTargetTarget.y=0,globeTarget.y=globeRotation,lightTarget.x=0,lightTarget.y=200,lightTarget.z=0,rotatorTarget.x=0,rotatorTarget.z=0,doSceneTweens(),doMaterialTweens())}function getCameraState(){camPos.x=camera.position.x,camPos.y=camera.position.y,camPos.z=camera.position.z,camTarget.x=controls.target.x,camTarget.y=controls.target.y,camTarget.z=controls.target.z}function doSceneTweens(){tweenGlobe.start(),tweenRotator.start(),tweenLight.start(),tweencamPos.start(),tweencamTarget.start()}function doMaterialTweens(){for(x in viewsList)currentView==x?window[viewsList[x]+"_tween"].start():window[viewsList[x]+"_tween"].stop()}function position(e){if(void 0==$("#"+e).offset())return!1;var t=$("#"+e).offset().top,a=t+$("#"+e).height();return(t+a)/2}function startDivCheck(){setInterval(function(){docViewTop=$(window).scrollTop(),docViewBottom=docViewTop+$(window).height(),docMiddle=(docViewTop+docViewBottom)/2;var e=["",1e6];for(var t in divList){var a=Math.abs(position(t)-docMiddle);a<e[1]&&(e[0]=t,e[1]=a)}e[0]!=currentDiv&&(currentDiv=e[0],$("#globecontainer").fadeOut(100,function(){setTimeout($("#globecontainer").appendTo("#"+e[0]),250)}).fadeIn(350),divList[e[0]]())},500)}function globeResize(){container=document.getElementById("globecontainer");for(div in divList)$("#"+div).height(container.offsetWidth);containerHeight=container.offsetWidth,renderer.setSize(container.offsetWidth,containerHeight),camera.aspect=container.offsetWidth/containerHeight,camera.updateProjectionMatrix(),render()}function addRTT(e,t){RTTs[e]=t,3==Object.keys(RTTs).length&&init()}function adjustNormScene(e,t){normTexture=new THREE.WebGLRenderTarget(e,t,renderTargetParams),normTextureMat.uniforms.u_textureSize.value=new THREE.Vector2(e,t),normTextureMat.needsUpdate=!0,normScene.remove(normTextureMesh),normTextureGeo=new THREE.PlaneGeometry(e,t),normTextureMesh=new THREE.Mesh(normTextureGeo,normTextureMat),normTextureMesh.position.z=-100,normScene.add(normTextureMesh),normCamera=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,1,1e4)}function onMouseMove(e){if(mouseDown){e.preventDefault();var t=e.clientX-mouseX,a=e.clientY-mouseY;0!=e.clientX&&(mouseX=e.clientX,mouseY=e.clientY),rotateScene(t,a),render()}}function onMouseDown(e){e.preventDefault(),mouseDown=!0,0!=e.clientX&&(mouseX=e.clientX,mouseY=e.clientY)}function onMouseUp(e){e.preventDefault(),mouseDown=!1}function addMouseHandler(e){e.addEventListener("mousemove",function(e){onMouseMove(e)},!1),e.addEventListener("mousedown",function(e){onMouseDown(e)},!1),e.addEventListener("mouseup",function(e){onMouseUp(e)},!1)}function rotateScene(e,t){globe.rotation.y+=e/100,globe.rotation.y>Math.PI&&(globe.rotation.y-=2*Math.PI),globe.rotation.y<-Math.PI&&(globe.rotation.y+=2*Math.PI)}var camera,scene,renderer,container,light,ambientLight,pointLight,globe=new THREE.Object3D,rotator=new THREE.Object3D,globeImage,europeImage,alpsImage,regionImage,mountainImage,globeTexture,alpsTexture,regionTexture,mountainTexture,myDbgMat,myDbgMat2,myDbgMat3,RTTs={},normScene,normCamera,normTexture,normTextureMat,normTextureGeo,mats,textureMats,easeType,easeSpeed,loopSteps=1,large=$(window).width()<1200?!1:!0,clock=new THREE.Clock;startTime=new Date;var divList={div2:doDiv2,div3:doDiv3,div4:doDiv4,div5:doDiv5,div6:doDiv6,div7:doDiv7,div8:doDiv8},vs,fs_erode,fs_dilate,fs_maximum,fs_rtt,vs_main,fs_main;SHADER_LOADER.load(function(e){vs=e.vs_rt.vertex,fs_erode=e.fs_erode.fragment,fs_dilate=e.fs_dilate.fragment,fs_rtt=e.fs_rtt.fragment,vs_main=e.vs_main.vertex,fs_main=e.fs_main.fragment});var requestId;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var camPos={x:0,y:0,z:-1200},camTarget={x:0,y:0,z:0},camPosTarget={x:0,y:0,z:-1200},camTargetTarget={x:0,y:0,z:0},globeTarget={y:0},rotatorTarget={x:0,z:0},lightPos={x:0,y:0,z:0},lightTarget={x:0,y:0,z:0},currentView=-1,lastView=0,currentDiv="",viewsList=["globe","globe2","europe","euroborders","alps","hannibal","region","mountain"],matsList=["globe","globe","globe","globe","alps","alps","region","mountain","globe"];globeRotation=1.42,globeSettings={opacity:0,bumpScale:0,uDisplacementPostScale:0,u_erode:large?.005:.008,u_dilate:.008,scale:0,diffuse:.3,steps:large?15:10},globeMain={opacity:1,bumpScale:25,uDisplacementPostScale:0,u_erode:large?.005:.008,u_dilate:.008,scale:1,diffuse:.3,steps:large?15:10},globe2Main={opacity:1,bumpScale:25,uDisplacementPostScale:large?80:50,u_erode:large?.005:.008,u_dilate:.008,scale:1,diffuse:.5,steps:large?15:10},europeMain={opacity:1,bumpScale:large?8:10,uDisplacementPostScale:large?28:30,u_erode:.05,u_dilate:.025,diffuse:.2,scale:1,steps:large?20:10},eurobordersMain={opacity:1,bumpScale:10,uDisplacementPostScale:30,u_erode:.03,u_dilate:.025,diffuse:.2,scale:1,steps:10},alpsSettings={opacity:0,opacity2:0,bumpScale:10,u_erode:.05,u_dilate:.02,diffuse:.4,uDisplacementPostScale:4,uPointLightColor:.5,shininess:40,specular:3},alpsMain={opacity:1,opacity2:1,bumpScale:10,u_erode:.05,u_dilate:.02,diffuse:.4,uDisplacementPostScale:4,uPointLightColor:.5,shininess:40,specular:3},hannibalMain={opacity:1,opacity2:1,bumpScale:5.5,u_erode:.15,u_dilate:.08,diffuse:.75,uDisplacementPostScale:2,uPointLightColor:.5,shininess:50,specular:2.5},regionSettings={opacity:0,bumpScale:2.2,u_erode:.04,u_dilate:.012,steps:15,diffuse:.8,uDisplacementPostScale:1,uPointLightColor:.5,shininess:50,specular:2.5},regionMain={opacity:1,bumpScale:3,u_erode:.04,u_dilate:.012,steps:5,diffuse:.8,uDisplacementPostScale:.45,uPointLightColor:.5,shininess:20,specular:2.5},mountainSettings={opacity:0,bumpScale:.2,u_erode:1,u_dilate:1,diffuse:1,uDisplacementPostScale:.04},mountainMain={opacity:1,bumpScale:.2,u_erode:1,u_dilate:1,diffuse:1,uDisplacementPostScale:.04},globe3Main={opacity:0,bumpScale:5.5,u_erode:.02,u_dilate:.01,diffuse:.2,uDisplacementPostScale:1};var easeType=TWEEN.Easing.Quartic.InOut;tweencamPos=new TWEEN.Tween(camPos).to(camPosTarget,2e3).easing(easeType).onUpdate(function(){camera.position.x=camPos.x,camera.position.y=camPos.y,camera.position.z=camPos.z}),tweencamTarget=new TWEEN.Tween(camTarget).to(camTargetTarget,2e3).easing(easeType).onUpdate(function(){controls.target.x=camTarget.x,controls.target.y=camTarget.y,controls.target.z=camTarget.z}),tweenGlobe=new TWEEN.Tween(globe.rotation).to(globeTarget,2e3).easing(easeType).onUpdate(function(){globe.rotation.y=this.y}),tweenRotator=new TWEEN.Tween(rotator.rotation).to(rotatorTarget,2e3).easing(easeType).onUpdate(function(){rotator.rotation.x=this.x,rotator.rotation.z=this.z}),tweenLight=new TWEEN.Tween(lightPos).to(lightTarget,2e3).easing(easeType).onUpdate(function(){pointLight.position.set(this.x,this.y,this.z),setMatUniform("uPointLightPos",pointLight.position)});var globe_tween=new TWEEN.Tween(globeSettings).to(globeMain,2e3).easing(easeType).onStart(function(){globeMesh.visible=!0,globeMat.uniforms.opacity.value=1,alpsMat.uniforms.opacity.value=0,regionMat.uniforms.opacity.value=0,mountainMat.uniforms.opacity.value=0,globeMat.uniforms.tDiffuseOpacity.value=this.diffuse,globeMat.uniforms.bumpScale.value=this.bumpScale,globeTexture.textureMat2.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,globeTexture.textureMat.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat.uniforms.u_dilate.value=this.u_dilate,loopSteps=this.steps,prepTextures(RTTs.globe)}).onUpdate(function(){globeMat.uniforms.opacity.value=this.opacity,globeMat.uniforms.uDisplacementPostScale.value=this.uDisplacementPostScale,globeMesh.scale.set(this.scale,this.scale,this.scale),globeTexture.textureMat2.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,globeTexture.textureMat.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat.uniforms.u_dilate.value=this.u_dilate}),globe2_tween=new TWEEN.Tween(globeSettings).to(globe2Main,2e3).easing(easeType).onStart(function(){globeMesh.visible=!0,alpsMat.uniforms.opacity.value=0,regionMat.uniforms.opacity.value=0,mountainMat.uniforms.opacity.value=0,globeTexture.textureMat2.uniforms.u_erode.value=globeSettings.u_erode,globeTexture.textureMat2.uniforms.u_dilate.value=globeSettings.u_dilate,globeTexture.textureMat.uniforms.u_erode.value=globeSettings.u_erode,globeTexture.textureMat.uniforms.u_dilate.value=globeSettings.u_dilate,loopSteps=this.steps,prepTextures(RTTs.globe)}).onUpdate(function(){globeMat.uniforms.tDiffuseOpacity.value=this.diffuse,globeMat.uniforms.opacity.value=this.opacity,globeMat.uniforms.bumpScale.value=this.bumpScale,globeMat.uniforms.uDisplacementPostScale.value=this.uDisplacementPostScale,globeTexture.textureMat2.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,globeTexture.textureMat.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat.uniforms.u_dilate.value=this.u_dilate,lastView>=2&&prepTextures(RTTs.globe),globeMesh.scale.set(this.scale,this.scale,this.scale)}).onComplete(function(){prepTextures(RTTs.globe)}),europe_tween=new TWEEN.Tween(globeSettings).to(europeMain,2e3).easing(easeType).onStart(function(){alpsMat.uniforms.opacity.value=0,regionMat.uniforms.opacity.value=0,mountainMat.uniforms.opacity.value=0,globeMesh.visible=!0,globeMesh.scale.set(1,1,1)}).onUpdate(function(){globeMat.uniforms.opacity.value=this.opacity,globeMat.uniforms.uDisplacementPostScale.value=this.uDisplacementPostScale,globeMat.uniforms.bumpScale.value=this.bumpScale,globeSettings.u_erode!=europeMain.u_erode&&(globeTexture.textureMat2.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,globeTexture.textureMat.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat.uniforms.u_dilate.value=this.u_dilate,prepTextures(RTTs.globe))}),euroborders_tween=new TWEEN.Tween(globeSettings).to(eurobordersMain,2e3).easing(easeType).onStart(function(){lastView>3&&(alpsMat.depthTest=!1,alpsSettings.opacity=0),globeMat.uniforms.opacity.value=1,globeMesh.visible=!0,globeMesh.scale.set(1,1,1),globeTexture.textureMat2.uniforms.u_erode.value=eurobordersMain.u_erode,globeTexture.textureMat2.uniforms.u_dilate.value=eurobordersMain.u_dilate,globeTexture.textureMat.uniforms.u_erode.value=eurobordersMain.u_erode,globeTexture.textureMat.uniforms.u_dilate.value=eurobordersMain.u_dilate,prepTextures(RTTs.globe)}).onUpdate(function(){globeMat.uniforms.bumpScale.value=this.bumpScale,globeMat.uniforms.uDisplacementPostScale.value=this.uDisplacementPostScale,globeSettings.u_erode!=europeMain.u_erode&&(globeTexture.textureMat2.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,globeTexture.textureMat.uniforms.u_erode.value=this.u_erode,globeTexture.textureMat.uniforms.u_dilate.value=this.u_dilate,prepTextures(RTTs.globe)),lastView>3&&(mats[lastView].uniforms.opacity.value=alpsSettings.opacity=1-this.opacity)}).onComplete(function(){});alps_tween=new TWEEN.Tween(alpsSettings).to(alpsMain,2e3).easing(easeType).onStart(function(){alpsMat.depthTest=!1,globeMesh.scale.set(1,1,1),regionMat.uniforms.opacity.value=0,mountainMat.uniforms.opacity.value=0,currentView>lastView&&(alpsTexture.textureMat2.uniforms.u_erode.value=this.u_erode,alpsTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,alpsTexture.textureMat.uniforms.u_erode.value=this.u_erode,alpsTexture.textureMat.uniforms.u_dilate.value=this.u_dilate,prepTextures(RTTs.alps))}).onUpdate(function(){alpsMat.uniforms.tDiffuseOpacity.value=this.diffuse,alpsMat.uniforms.uPointLightColor.value=(new THREE.Color).setRGB(this.uPointLightColor,this.uPointLightColor,this.uPointLightColor),alpsMat.uniforms.shininess.value=this.shininess,alpsMat.uniforms.specular.value=(new THREE.Color).setRGB(this.specular,this.specular,this.specular),alpsMat.uniforms.bumpScale.value=this.bumpScale,alpsMat.uniforms.uDisplacementPostScale.value=this.uDisplacementPostScale,alpsMat.uniforms.opacity.value=this.opacity,alpsTexture.textureMat2.uniforms.u_erode.value=this.u_erode,alpsTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,alpsTexture.textureMat.uniforms.u_erode.value=this.u_erode,alpsTexture.textureMat.uniforms.u_dilate.value=this.u_dilate,currentView>lastView?globeMat.uniforms.uDisplacementPostScale.value=globeSettings.uDisplacementPostScale*(1-.75*this.opacity):5==lastView&&prepTextures(RTTs.alps)}).onComplete(function(){globeMesh.scale.set(.95,.95,.95),alpsMat.depthTest=!0,regionMat.uniforms.opacity.value=0,mountainMat.uniforms.opacity.value=0}),hannibal_tween=new TWEEN.Tween(alpsSettings).to(hannibalMain,2e3).easing(easeType).onStart(function(){globeMesh.visible=!1,regionMat.uniforms.opacity.value=0,mountainMat.uniforms.opacity.value=0,alpsTexture.textureMat2.uniforms.u_erode.value=this.u_erode,alpsTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,alpsTexture.textureMat.uniforms.u_erode.value=this.u_erode,alpsTexture.textureMat.uniforms.u_dilate.value=this.u_dilate,prepTextures(RTTs.alps)}).onUpdate(function(){alpsMat.uniforms.bumpScale.value=this.bumpScale,alpsMat.uniforms.tDiffuseOpacity.value=this.diffuse,alpsMat.uniforms.bumpScale.value=this.bumpScale,alpsMat.uniforms.uDisplacementPostScale.value=this.uDisplacementPostScale,alpsMat.uniforms.opacity.value=this.opacity,alpsTexture.textureMat2.uniforms.u_erode.value=this.u_erode,alpsTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,alpsTexture.textureMat.uniforms.u_erode.value=this.u_erode,alpsTexture.textureMat.uniforms.u_dilate.value=this.u_dilate,alpsMat.uniforms.uPointLightColor.value=(new THREE.Color).setRGB(this.uPointLightColor,this.uPointLightColor,this.uPointLightColor),alpsMat.uniforms.shininess.value=this.shininess,alpsMat.uniforms.specular.value=(new THREE.Color).setRGB(this.specular,this.specular,this.specular),4==lastView?prepTextures(RTTs.alps):6==lastView&&(regionSettings.opacity=1-this.opacity2,regionMat.uniforms.opacity.value=1-this.opacity2)}).onComplete(function(){globeMesh.scale.set(.95,.95,.95),regionMat.uniforms.opacity.value=0,mountainMat.uniforms.opacity.value=0,prepTextures(RTTs.alps)}),region_tween=new TWEEN.Tween(regionSettings).to(regionMain,2e3).easing(easeType).onStart(function(){alpsMat.depthTest=!1,mountainMat.uniforms.opacity.value=0,regionMat.uniforms.tDiffuseOpacity.value=this.diffuse,regionMat.uniforms.bumpScale.value=this.bumpScale,regionMat.depthTest=!0,regionMat.uniforms.uPointLightColor.value=(new THREE.Color).setRGB(this.uPointLightColor,this.uPointLightColor,this.uPointLightColor),regionMat.uniforms.shininess.value=this.shininess,regionMat.uniforms.specular.value=(new THREE.Color).setRGB(this.specular,this.specular,this.specular),loopSteps=this.steps,regionTexture.textureMat2.uniforms.u_erode.value=this.u_erode,regionTexture.textureMat2.uniforms.u_dilate.value=this.u_dilate,regionTexture.textureMat.uniforms.u_erode.value=this.u_erode,regionTexture.textureMat.uniforms.u_dilate.value=this.u_dilate,6>lastView&&(alpsSettings.uDisplacementPostScale=alpsMat.uniforms.uDisplacementPostScale.value,regionMat.uniforms.opacity.value=0),prepTextures(RTTs.region)}).onUpdate(function(){regionMat.uniforms.opacity.value=this.opacity,regionMat.uniforms.uDisplacementPostScale.value=this.uDisplacementPostScale,regionMat.uniforms.tDiffuseOpacity.value=this.diffuse,5==lastView&&(alpsMat.uniforms.uDisplacementPostScale.value=alpsSettings.uDisplacementPostScale*(1-.75*Math.max(this.opacity,.01))),7==lastView&&(mountainMat.uniforms.opacity.value=1-this.opacity,mountainSettings.opacity=1-this.opacity)}),mountain_tween=new TWEEN.Tween(mountainSettings).to(mountainMain,2e3).easing(easeType).onStart(function(){globeMat.uniforms.opacity.value=0,alpsMat.uniforms.opacity.value=0,regionMat.uniforms.opacity.value=1-this.opacity,mountainMat.uniforms.opacity.value=this.opacity,mountainMat.uniforms.bumpScale.value=this.bumpScale,mountainMat.uniforms.tDiffuseOpacity.value=this.diffuse,mountainMat.uniforms.uPointLightColor.value=(new THREE.Color).setRGB(0,0,0),mountainMat.uniforms.uDisplacementPostScale.value=this.uDisplacementPostScale}).onUpdate(function(){mountainMat.uniforms.opacity.value=this.opacity,regionMat.uniforms.opacity.value=1-this.opacity});var docViewTop,docViewBottom;window.onload=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),a=e.indexOf("Trident");if(!Detector.webgl||t>0||a>0)return void log("Scene failed to start.");container=document.getElementById("globecontainer");for(div in divList)$("#"+div).height(container.offsetWidth+"px");document.getElementById("apology").innerHTML="(Click and drag to rotate each view.)";var o=document.getElementsByClassName("fallback");for(i=0;i<o.length;i++)o[i].style.display="none",o[i].style.visibility="hidden";window.addEventListener("resize",function(){globeResize()}),globeImage=THREE.ImageUtils.loadTexture(large?"../img/Srtm.2k_norm.jpg":"../img/Srtm.1k_norm.jpg",new THREE.UVMapping,function(){globeTexture=prepRTT(globeImage,vs,fs_dilate),addRTT("globe",globeTexture)}),alpsImage=THREE.ImageUtils.loadTexture(large?"../img/alps_2k_norm.jpg":"../img/alps_1k_norm.jpg",new THREE.UVMapping,function(){alpsTexture=prepRTT(alpsImage,vs,fs_dilate),addRTT("alps",alpsTexture)}),regionImage=THREE.ImageUtils.loadTexture(large?"../img/region2_2k.jpg":"../img/region2_1k.jpg",new THREE.UVMapping,function(){regionTexture=prepRTT(regionImage,vs,fs_dilate),addRTT("region",regionTexture)})};var mouseDown=!1,mouseX=0,mouseY=0;